require("data",function(n,r){function e(n){var r=[];return n.forEach(function(n){var e=n[0]>>8,o=e+".json";r.indexOf(o)<0&&r.push(o)}),r}function o(n,r){function e(){if(0==t.length)r(o);else{var n=t.pop();o[n]=null;var a=i.get(s+n);a.onsuccess=function(){var r=this.result,t=new FileReader;t.onload=function(){var a=t.result;try{o[n]=JSON.parse(a)}catch(s){console.error("Invalid JSON for file `"+r.name+"`!"),console.error(s)}e()},t.readAsText(r)},a.onerror=function(){console.error("Unable to load file `"+s+n+"`!"),console.error(this.error),e()}}}var o={},t=n.slice();e()}var t=30;n.ERR_NO_NAVIGATOR=1,n.ERR_NO_DEVICE_STORAGE=2,n.ERR_UNAVAILABLE_DEVICE=3,n.ERR_SHARED_DEVICE=4,n.ERR_INDEX_NOT_FOUND=5,n.ERR_INVALID_INDEX=6;var a,s,i=null;n.countAreas=function(){return a.latlng.length/2},n.countPhotos=function(){return a.photos},n.getDate=function(){return a.date},n.loadPhotoDataURI=function(n){return new Promise(function(r,e){"function"!=typeof e&&(e=function(n){console.log(Error(n))});var o=i.get(s+n);o.onsuccess=function(){var n=this.result,e=new FileReader;e.onload=function(){var n=e.result;r(n)},e.readAsDataURL(n)},o.onerror=function(n){e(this.error)}})},n.init=function(r,e){function o(){if(l.length>0&&0==u){var n=l.pop();t(n)}else u?e(u):r()}function t(r){var o=r.available();o.onsuccess=function(){var o=this.result;switch(o){case"available":c(r);break;case"unavailable":e(n.ERR_UNAVAILABLE_DEVICE);break;case"shared":e(n.ERR_SHARED_DEVICE)}},o.onerror=function(){console.error(this.error)}}function c(o){s="/"+o.storageName+"/CampingCarAreas/";var t=s+"index.json",c=o.get(t);c.onsuccess=function(){var t=this.result,s=new FileReader;s.onload=function(){var t=s.result;try{a=JSON.parse(t)}catch(c){console.error(c),e(n.ERR_INVALID_INDEX)}i=o,r()},s.readAsText(t)},c.onerror=function(){console.error('Unable to get file "'+t+'"!'),console.error(this.error)}}if(navigator)if("function"==typeof navigator.getDeviceStorage){var l=navigator.getDeviceStorages("sdcard"),u=0;o()}else console.log("ERR_NO_DEVICE_STORAGE"),e(n.ERR_NO_DEVICE_STORAGE);else console.log("ERR_NO_NAVIGATOR"),e(n.ERR_NO_NAVIGATOR)},n.getType=function(n){return a.types[n]},n.distance=function(n,r,e,o){var t=6371,a=Math.PI*(e-n)/180,s=Math.PI*(o-r)/180,i=Math.sin(a/2)*Math.sin(a/2)+Math.cos(Math.PI*n/180)*Math.cos(Math.PI*e/180)*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),l=Math.floor(t*c*1e3);return l},n.find=function(r,s,i){r.coords&&(r={lat:r.coords.latitude,lng:r.coords.longitude}),console.info("[data] args=...",r);var c,l,u,f,E=[],h=r.lat,R=r.lng,d=r.radius,v=a.latlng;for("undefined"==typeof d&&(d=1e5),c=0;c<v.length;c+=2)l=v[c]/1e6,u=v[c+1]/1e6,f=n.distance(l,u,h,R),d>f&&E.push([c>>1,f]);E.sort(function(n,r){return n[1]-r[1]}),E.length>t&&(E=E.slice(0,t));var _=e(E);o(_,function(n){var r=[];E.forEach(function(e){var o,t,a=e[0],s=a>>8,i=255&a,c=n[s+".json"],l=e[1],u={$idx:a,$dis:l};for(o in c)t=c[o],u[o]=t[i];r.push(u)}),s(r)})}});
//# sourceMappingURL=data.js.map